/*! Built with http://stenciljs.com */
var e=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))(function(a,r){function l(e){try{c(n.next(e))}catch(e){r(e)}}function o(e){try{c(n.throw(e))}catch(e){r(e)}}function c(e){e.done?a(e.value):new i(function(t){t(e.value)}).then(l,o)}c((n=n.apply(e,t||[])).next())})},t=this&&this.__generator||function(e,t){var i,n,a,r,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return r={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function o(r){return function(o){return function(r){if(i)throw new TypeError("Generator is already executing.");for(;l;)try{if(i=1,n&&(a=2&r[0]?n.return:r[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,r[1])).done)return a;switch(n=0,a&&(r=[2&r[0],a.value]),r[0]){case 0:case 1:a=r;break;case 4:return l.label++,{value:r[1],done:!1};case 5:l.label++,n=r[1],r=[0];continue;case 7:r=l.ops.pop(),l.trys.pop();continue;default:if(!(a=(a=l.trys).length>0&&a[a.length-1])&&(6===r[0]||2===r[0])){l=0;continue}if(3===r[0]&&(!a||r[1]>a[0]&&r[1]<a[3])){l.label=r[1];break}if(6===r[0]&&l.label<a[1]){l.label=a[1],a=r;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(r);break}a[2]&&l.ops.pop(),l.trys.pop();continue}r=t.call(e,l)}catch(e){r=[6,e],n=0}finally{i=a=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,o])}}};App.loadBundle("fgysnpd7",["exports"],function(i){var n=window.App.h;function a(e,t){return"screenshot_mismatch_"+e+"_"+t}var r=function(){function e(){this.diffs=[]}return e.prototype.componentWillLoad=function(){var e,t,i,n;this.diffs=(e=this.buildB,t=this.imagesUrl,i=this.jsonpUrl,n=this.buildA.screenshots.map(function(e){return{id:e.id,desc:e.desc,imageA:e.image,imageUrlA:""+t+e.image,jsonpUrlA:i+"screenshot_"+e.image+".js",imageB:null,imageUrlB:null,jsonpUrlB:null,mismatchedPixels:null,mismatchedRatio:null,width:e.width,height:e.height,deviceScaleFactor:e.deviceScaleFactor,naturalWidth:e.naturalWidth,naturalHeight:e.naturalHeight,device:e.device,userAgent:e.userAgent}}),e.screenshots.forEach(function(e){var a=n.find(function(t){return t.id===e.id});a?(a.imageB=e.image,a.imageUrlB=""+t+e.image,a.jsonpUrlB=i+"screenshot_"+e.image+".js"):n.push(a={id:e.id,desc:e.desc,imageA:null,imageUrlA:null,jsonpUrlA:null,imageB:e.image,imageUrlB:""+t+e.image,jsonpUrlB:i+"screenshot_"+e.image+".js",mismatchedPixels:null,mismatchedRatio:null,width:e.width,height:e.height,deviceScaleFactor:e.deviceScaleFactor,naturalWidth:e.naturalWidth,naturalHeight:e.naturalHeight,device:e.device,userAgent:e.userAgent})}),n.forEach(function(e){if(e.identical=e.imageUrlA===e.imageUrlB,e.identical)return e.mismatchedPixels=0,void(e.mismatchedRatio=0);var t,i,n=(t=a(e.imageA,e.imageB),"string"==typeof(i=localStorage.getItem(t))?parseInt(i,10):null);"number"!=typeof n||(e.mismatchedPixels=n,e.mismatchedRatio=e.mismatchedPixels/(e.naturalWidth*e.naturalHeight),0!==e.mismatchedPixels)||(e.identical=!0)}),n)},e.prototype.render=function(){return[n("ion-header",null,n("ion-toolbar",{color:"primary"},n("ion-title",null,"Screenshot Compare"))),n("ion-content",{"scroll-x":"true"},n("table",null,n("tr",null,n("th",null,"Master"),n("th",null,this.buildB.message),n("th",null,"Diff"),n("th",null,"Analysis")),this.diffs.map(function(e){return n("tr",{key:e.id},n("td",null,e.imageUrlA?n("a",{id:"link-a-"+e.id,style:{width:e.width+"px",height:e.height+"px"},href:e.imageUrlA,class:"img-link",target:"_blank"}):null),n("td",null,e.imageUrlB?n("a",{id:"link-b-"+e.id,style:{width:e.width+"px",height:e.height+"px"},href:e.imageUrlB,class:"img-link",target:"_blank"}):null),n("td",null,n("local-pixelmatch",{diff:e})),n("td",{class:"analysis"},n("div",null,e.device||e.userAgent?n("strong",null,e.device||e.userAgent,": "):null,e.desc),n("div",null,n("strong",null,"Mismatched Pixels"),": ",n("span",{id:"mismatch-pixels-"+e.id},null!=e.mismatchedPixels?e.mismatchedPixels:"...")),n("div",null,n("strong",null,"Mismatched Ratio"),": ",n("span",{id:"mismatch-ratio-"+e.id},null!=e.mismatchedRatio?e.mismatchedRatio.toFixed(4):"..."))))})))]},Object.defineProperty(e,"is",{get:function(){return"local-compare"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"properties",{get:function(){return{buildA:{type:"Any",attr:"build-a"},buildB:{type:"Any",attr:"build-b"},imagesUrl:{type:String,attr:"images-url"},jsonpUrl:{type:String,attr:"jsonp-url"}}},enumerable:!0,configurable:!0}),e}();function l(e,t,i,n,a,r){for(var c,u,d,s,h=Math.max(t-1,0),m=Math.max(i-1,0),g=Math.min(t+1,n-1),f=Math.min(i+1,a-1),p=4*(i*n+t),v=0,x=0,y=0,b=0,w=0,A=h;A<=g;A++)for(var B=m;B<=f;B++)if(A!==t||B!==i){var U=o(e,e,p,4*(B*n+A),!0);if(0===U?v++:U<0?y++:U>0&&x++,v>2)return!1;r&&(U<b&&(b=U,c=A,u=B),U>w&&(w=U,d=A,s=B))}return!r||0!==y&&0!==x&&(!l(e,c,u,n,a)&&!l(r,c,u,n,a)||!l(e,d,s,n,a)&&!l(r,d,s,n,a))}function o(e,t,i,n,a){var r=e[i+3]/255,l=t[n+3]/255,o=s(e[i+0],r),h=s(e[i+1],r),m=s(e[i+2],r),g=s(t[n+0],l),f=s(t[n+1],l),p=s(t[n+2],l),v=c(o,h,m)-c(g,f,p);if(a)return v;var x=u(o,h,m)-u(g,f,p),y=d(o,h,m)-d(g,f,p);return.5053*v*v+.299*x*x+.1957*y*y}function c(e,t,i){return.29889531*e+.58662247*t+.11448223*i}function u(e,t,i){return.59597799*e-.2741761*t-.32180189*i}function d(e,t,i){return.21147017*e-.52261711*t+.31114694*i}function s(e,t){return 255+(e-255)*t}function h(e,t,i,n,a){e[t+0]=i,e[t+1]=n,e[t+2]=a,e[t+3]=255}var m=function(){function i(){this.initialized=!1}return i.prototype.componentDidLoad=function(){var e=this,t=this.diff,i=new Image(t.naturalWidth,t.naturalHeight);i.style.width=t.width+"px",i.style.height=t.height+"px";var n=new Image(t.naturalWidth,t.naturalHeight);if(n.style.width=t.width+"px",n.style.height=t.height+"px",null!=t.imageA){i.onload=function(){var a=document.getElementById("link-a-"+t.id);a&&(a.appendChild(i),e.pixelmatch(i,n)),i.onload=null},g.push({imageName:t.imageA,callback:function(e){i.src=e}});var a=document.createElement("script");a.src=t.jsonpUrlA,document.head.appendChild(a)}if(null!=t.imageB){n.onload=function(){var a=document.getElementById("link-b-"+t.id);a&&(a.appendChild(n),e.pixelmatch(i,n)),n.onload=null},g.push({imageName:t.imageB,callback:function(e){n.src=e}});var r=document.createElement("script");r.src=t.jsonpUrlB,document.head.appendChild(r)}},i.prototype.pixelmatch=function(i,n){return e(this,void 0,void 0,function(){var e,r;return t(this,function(t){switch(t.label){case 0:return e=this.diff,!i.complete||!n.complete||this.initialized||e.identical?[2]:(this.initialized=!0,r=e,[4,function(e,t,i,n,a){var r=document.createElement("canvas");r.width=n,r.height=a;var u=document.createElement("canvas");u.width=n,u.height=a;var d=r.getContext("2d");d.drawImage(e,0,0);var m=u.getContext("2d");m.drawImage(t,0,0);var g=document.createElement("canvas").getContext("2d");g.drawImage(e,0,0),g.getImageData(0,0,n,a);var f=d.getImageData(0,0,n,a).data,p=m.getImageData(0,0,n,a).data,v=i.getContext("2d"),x=v.createImageData(n,r.height),y=function(e,t,i,n,a,r){r||(r={});for(var u=void 0===r.threshold?.1:r.threshold,d=35215*u*u,m=0,g=0;g<a;g++)for(var f=0;f<n;f++){var p=4*(g*n+f);if(o(e,t,p,p)>d)r.includeAA||!l(e,f,g,n,a,t)&&!l(t,f,g,n,a,e)?(i&&h(i,p,255,0,0),m++):i&&h(i,p,255,255,0);else if(i){var v=s(c(s((x=e)[(y=p)+0],b=x[y+3]/255),s(x[y+1],b),s(x[y+2],b)),.1);h(i,p,v,v,v)}}var x,y,b;return m}(f,p,x.data,n,a,{threshold:.1});return v.putImageData(x,0,0),y}(i,n,this.canvasDiff,e.naturalWidth,e.naturalHeight)]);case 1:return r.mismatchedPixels=t.sent(),document.getElementById("mismatch-pixels-"+e.id).textContent=e.mismatchedPixels+"",e.mismatchedRatio=e.mismatchedPixels/(e.naturalWidth*e.naturalHeight),document.getElementById("mismatch-ratio-"+e.id).textContent=e.mismatchedRatio.toFixed(4),u=e.mismatchedPixels,d=a(e.imageA,e.imageB),localStorage.setItem(d,String(u)),[2]}var u,d})})},i.prototype.render=function(){var e=this,t=this.diff;return t.identical?n("img",{src:t.imageUrlA,style:{width:t.width+"px",height:t.height+"px"}}):[n("canvas",{ref:function(t){return e.canvasDiff=t},width:t.naturalWidth,height:t.naturalHeight,style:{width:t.width+"px",height:t.height+"px"}})]},Object.defineProperty(i,"is",{get:function(){return"local-pixelmatch"},enumerable:!0,configurable:!0}),Object.defineProperty(i,"properties",{get:function(){return{diff:{type:"Any",attr:"diff"}}},enumerable:!0,configurable:!0}),i}(),g=[];window.loadScreenshot=function(e,t){g.filter(function(t){return t.imageName===e}).forEach(function(e){return e.callback(t)})},i.LocalCompare=r,i.LocalPixelmatch=m,Object.defineProperty(i,"__esModule",{value:!0})});